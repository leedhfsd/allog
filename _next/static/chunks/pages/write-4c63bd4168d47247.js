(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{5776:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/write",function(){return s(9291)}])},9291:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return g},default:function(){return f}});var n=s(5893),a=s(1664),l=s.n(a),i=s(9008),r=s.n(i),c=s(7294),o=s(3299),u=s(1163),d=s(7441),m=s(7856),h=s.n(m),x=s(5660),p=s.n(x);s(1706),s(366),s(2503),s(6836),s(4279),s(2731),s(4064),s(6102),s(5266),s(4335),s(9499);var g=!0,f=function(e){let{data:t}=e,[s,a]=(0,c.useState)(""),[i,m]=(0,c.useState)(""),[x,g]=(0,c.useState)(!1),[f,w]=(0,c.useState)([]),[y,b]=(0,c.useState)(""),[j,v]=(0,c.useState)(!1),[N,k]=(0,c.useState)(!1),[_,S]=(0,c.useState)(""),C=(0,c.useRef)(null),T=(0,c.useRef)(null),E=(0,c.useRef)(null),{data:O}=(0,o.useSession)(),z=(0,u.useRouter)();d.TU.setOptions({highlight:(e,t)=>p().languages[t]?p().highlight(e,p().languages[t],t):e});let A=async()=>{await z.push("/")},D=e=>{let t=e.target;null!==C.current&&(C.current.style.height="30px",C.current.style.height="".concat(t.scrollHeight,"px")),a(t.value)},$=e=>{let t=e.target;m(t.value),S(d.TU.parse(t.value))},H=()=>g(e=>!e),P=e=>{var t;let s=e.target;!x||(null===(t=E.current)||void 0===t?void 0:t.contains(s))||g(!1)},R=e=>{let t=e.target;b(t.value)},F=e=>{"Enter"===e.key&&""!==y&&(e.preventDefault(),-1===f.indexOf(y)&&w([y,...f]),E.current&&(E.current.value=""),b(""))},L=e=>{let t=f.filter(t=>t!==e);w(t)},I=e=>{let t=e.target;t.checked?k(!0):k(!1)},M=async e=>{alert("이미지 파일의 크기가 큰 경우 업로드를 기다려주세요.");let t=new FormData;t.append("file",e),t.append("upload_preset","cqjvsfaj");let s=await fetch("https://api.cloudinary.com/v1_1/".concat("dkia5wxr4","/image/upload"),{method:"POST",body:t});return s.json()},U=async e=>{let t=await M(e.target.files[0]);S(_+d.TU.parse("\n![](".concat(t.secure_url,")\n"))),m(i+"\n![](".concat(t.secure_url,")\n")),null!==T.current&&(T.current.value="")},B=e=>{if(""!==s&&null!==O)v(!1);else{v(!0),setTimeout(()=>v(!1),1500);return}e.preventDefault();let n=new Date,a=n.getTime()+6e4*n.getTimezoneOffset(),l=new Date(a+324e5),r=async()=>{if(null==O?void 0:O.user){let e=s.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>{}[\]\\/]/gim,"").replace(/\n/gim," ").split(" ").join("-").trim();e||(e="".concat(n.getTime()));let a=i.match(/!\[(.*?)\]\((.*?)\)/g),r="";if(a&&a.length>0){let c=a[0].match(RegExp("(?<=\\().+?(?=\\))"));null!==c&&([r]=c)}let o=i.replace(/`([^`]+)`/g,"$1").replace(/!\[[^\]]*\]\(([^)]+)\)/g,"").replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1").replace(/(\*|_){1,2}([^*_]+)\1{1,2}/g,"$2").replace(/#{1,6}\s?(.*)/g,"$1").replace(/^\s*[-+*]\s?(.*)/gm,"$1").replace(/^\s*\d+\.\s?(.*)/gm,"$1").replace(/^\s*>/gm,"").trim();if(t){if(t&&Array.isArray(t)){let u=t[0],d={_id:u._id,title:s,content:i,plainText:o,hashtag:f,slug:e,thumbnailImage:r,sanitizedHtml:_,disclosureStatus:N};await fetch("/api/write",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}}else{let m={title:s,content:i,plainText:o,hashtag:f,createdAt:"".concat(l.getFullYear(),"년 ").concat(l.getMonth()+1,"월 ").concat(l.getDate(),"일"),writer:O.user.name,profile:O.user.image,slug:e,thumbnailImage:r,sanitizedHtml:_,disclosureStatus:N};await fetch("/api/write",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})}}};r().then(()=>A()).catch(e=>{throw e})};return(0,c.useEffect)(()=>{if(t&&Array.isArray(t)){let e=t[0];a(e.title),w(e.hashtag),m(e.content),S(e.sanitizedHtml)}},[t]),(0,c.useEffect)(()=>(x&&document.addEventListener("mousedown",P),()=>{document.removeEventListener("mousedown",P)})),(0,c.useEffect)(()=>{let e=document.getElementById("markdown-preview");e&&(e.innerHTML=h().sanitize(_))},[_]),(0,n.jsxs)("div",{className:"flex h-screen mx-2 sm:mx-4 md:mx-8 lg:mx-24 py-4",children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"글 작성 | Allog"}),(0,n.jsx)("meta",{name:"description",content:"Allog의 회원님들이 글을 작성하는 페이지입니다."}),(0,n.jsx)("meta",{name:"keywords",content:"BLOG, 블로그, Allog, 글작성"})]}),(0,n.jsx)("div",{className:"flex flex-col w-full lg:w-1/2",children:(0,n.jsx)("div",{children:(0,n.jsxs)("form",{children:[(0,n.jsxs)("div",{className:"",children:[(0,n.jsx)("textarea",{rows:1,spellCheck:!1,className:"text-4xl md:text-5xl font-bold focus:outline-none w-full resize-none truncate my-4",name:"title",placeholder:"제목을 입력하세요",value:s,onChange:D,ref:C}),(0,n.jsx)("hr",{className:"border-b-8 my-4 border-gray-700 w-32"}),(0,n.jsx)("input",{className:"hidden",type:"text"}),(0,n.jsxs)("div",{className:"w-5/6",children:[f.map(e=>(0,n.jsx)("div",{"aria-hidden":"true",onClick:()=>L(e),className:"text-sky-500 px-1 mx-2 my-2 cursor-pointer inline-block",children:e},e)),(0,n.jsx)("input",{ref:E,onChange:R,onMouseDown:H,autoComplete:"off",onKeyDown:F,className:"focus:outline-none mb-4 text-base sm:text-xl",name:"tag",type:"text",placeholder:"태그를 입력하세요"})]}),x&&(0,n.jsxs)("div",{className:"absolute bg-slate-700 text-white z-10 text-xs px-4 py-4 w-1/2 lg:w-2/5",children:[(0,n.jsx)("p",{children:"엔터를 입력하면 태그를 등록할 수 있습니다."}),(0,n.jsx)("p",{children:"등록된 태그를 클릭하면 삭제할 수 있습니다."})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"img",className:"hover:opacity-80",children:(0,n.jsx)("img",{src:"upload_64.png",alt:"img_upload",height:36,width:36})}),(0,n.jsx)("input",{ref:T,className:"hidden",type:"file",id:"img",accept:"image/*",onChange:U})]}),(0,n.jsx)("textarea",{className:"focus:outline-none resize-none text-lg w-full",rows:23,name:"content",placeholder:"내용을 입력하세요",onChange:$,value:i})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-4 mb-2",children:[(0,n.jsxs)("div",{className:"bg-[#333333] rounded py-1 px-2 sm:px-5",children:[(0,n.jsx)("input",{type:"checkbox",id:"private",onClick:I}),(0,n.jsx)("label",{htmlFor:"private",className:"mx-2 text-base sm:text-xl font-bold text-white",children:"비공개"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(l(),{href:"/",children:(0,n.jsx)("button",{type:"button",className:"text-sky-500 hover:text-sky-400 rounded text-base sm:text-xl mx-1 px-5 font-bold",children:"뒤로가기"})}),t?(0,n.jsx)("button",{type:"button",onClick:B,className:"bg-sky-500 hover:bg-sky-400 text-white rounded text-base sm:text-xl mx-1 px-5 py-1 font-bold",children:"수정하기"}):(0,n.jsx)("button",{type:"button",onClick:B,className:"bg-sky-500 hover:bg-sky-400 text-white rounded text-base sm:text-xl mx-1 px-5 py-1 font-bold",children:"출간하기"})]})]})]})})}),j&&(0,n.jsx)("div",{className:"top-4 right-4 bg-red-500 text-white text-base w-fit rounded px-4 py-1 absolute z-20",children:(0,n.jsx)("p",{children:"포스트에 실패하였습니다. 로그인과 제목 입력은 필수입니다."})}),(0,n.jsx)("div",{className:"hidden mt-16 lg:block lg:w-1/2",children:(0,n.jsx)("div",{className:"whitespace-pre-wrap markdown-body",id:"markdown-preview"})})]})}}},function(e){e.O(0,[218,423,774,888,179],function(){return e(e.s=5776)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{5824:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/setting",function(){return s(1514)}])},1514:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(5893),n=s(3299),l=s(9008),c=s.n(l),i=s(1163),r=s(7294);function d(){let{data:e,status:t}=(0,n.useSession)(),[s,l]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),[o,u]=(0,r.useState)(),[x,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(),[y,j]=(0,r.useState)(!1),[g,N]=(0,r.useState)(""),b=(0,i.useRouter)(),w=async()=>{await b.push("/auth/goodbye")};(0,r.useEffect)(()=>{if(e&&e.user){let t=e.user;u(t)}},[e]),(0,r.useEffect)(()=>{o&&fetch("api/auth/user?name=".concat(o.name)).then(e=>e.json()).then(e=>f(e)).catch(()=>{throw Error()})},[o]),(0,r.useEffect)(()=>{p&&p.nickname&&p.userinfo&&p.image&&(h(p.nickname),l(p.userinfo),N(p.image))},[p]);let v=()=>{m(!0)},k=e=>{let t=e.target;l(t.value)},_=e=>{let t=e.target;h(t.value)},E=async e=>{alert("변경 완료후 로그아웃 됩니다. 다시 로그인해주세요.");let t=new FormData;t.append("file",e),t.append("upload_preset","cqjvsfaj");let s=await fetch("https://api.cloudinary.com/v1_1/".concat("dkia5wxr4","/image/upload"),{method:"POST",body:t});return s.json()},C=async e=>{let t=await E(e.target.files[0]);N(t.secure_url),await fetch("/api/auth/user?email=".concat(null==p?void 0:p.email,"&image=").concat(t.secure_url),{method:"PATCH"}),await (0,n.signOut)()},S=async()=>{p&&(await fetch("/api/article?writer=".concat(p.name),{method:"DELETE"}),await fetch("/api/comment?author=".concat(p.name),{method:"DELETE"}),await fetch("/api/auth/user?email=".concat(p.email),{method:"DELETE"}).then(()=>w()).then(()=>(0,n.signOut)()))},T=async()=>{p&&await fetch("/api/auth/user?email=".concat(null==p?void 0:p.email,"&nickname=").concat(x,"&userinfo=").concat(s),{method:"PATCH"}).then(()=>m(!1))};return"unauthenticated"===t?(0,a.jsx)("div",{children:"로그인 후 이용 가능합니다."}):(0,a.jsxs)("div",{children:[(0,a.jsxs)(c(),{children:[(0,a.jsx)("title",{children:"설정 | Allog"}),(0,a.jsx)("meta",{name:"description",content:""}),(0,a.jsx)("meta",{name:"keywords",content:"BLOG, 블로그, Allog"})]}),e&&e.user&&(0,a.jsxs)("div",{className:"flex flex-col min-h-[720px] my-16 md:w-[768px] md:mx-32",children:[(0,a.jsxs)("section",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"w-[128px] h-[128px]",children:g?(0,a.jsx)("img",{src:g,alt:"user-img",className:"rounded-full aspect-square"}):(0,a.jsx)("img",{src:e.user.image,alt:"user-img",className:"rounded-full aspect-square"})}),(0,a.jsx)("label",{htmlFor:"img",className:"mt-4 mb-2 text-white bg-sky-500 rounded-md py-1.5 text-sm text-center",children:"이미지 변경"}),(0,a.jsx)("input",{className:"hidden",type:"file",id:"img",accept:"image/*",onChange:C})]}),(0,a.jsx)("div",{className:"ml-12 w-5/6",children:d?(0,a.jsxs)("div",{className:"flex flex-col my-4",children:[(0,a.jsx)("label",{className:"",htmlFor:"nickname",children:"별명"}),(0,a.jsx)("input",{className:"py-1.5 border rounded border-gray-300 my-2 focus:outline-sky-400",type:"text",id:"nickname",placeholder:"별명 변경(최대 15자)",onChange:_,value:x,maxLength:15}),(0,a.jsx)("label",{htmlFor:"userinfo",children:"한 줄 메시지"}),(0,a.jsx)("input",{className:"py-1.5 border rounded border-gray-300 my-2 mb-4 focus:outline-sky-400",type:"text",id:"userinfo",placeholder:"한 줄 메시지를 작성해주세요(최대 30자)",onChange:k,value:s,maxLength:30}),(0,a.jsx)("button",{type:"button",className:"text-white bg-sky-500 rounded-md py-1 px-4 my-2 w-[72px] text-sm",onClick:T,children:"변경"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:null==o?void 0:o.name}),(0,a.jsx)("button",{className:"my-4 text-sm underline text-sky-500",type:"button",onClick:v,children:"소개말 수정"})]})})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex mt-16 items-center",children:[(0,a.jsx)("h3",{className:"font-bold mr-12",children:"회원탈퇴"}),(0,a.jsx)("button",{type:"button",className:"bg-red-500 px-4 py-1.5 text-white rounded-md text-sm",onClick:()=>j(e=>!e),children:"회원 탈퇴"})]}),(0,a.jsx)("p",{className:"text-gray-500 text-xs my-3",children:"회원님의 모든 작성글과 회원정보가 삭제되며 복구되지 않습니다."}),(0,a.jsxs)("div",{className:"flex mt-12 items-center",children:[(0,a.jsx)("h3",{className:"font-bold mr-12",children:"이용문의"}),(0,a.jsx)("span",{className:"font-bold text-sm text-gray-600",children:"leedhfsd@gmail.com"})]}),(0,a.jsx)("p",{className:"text-gray-500 text-xs my-3",children:"이용하시면서 불편하시던 점을 피드백을 주시면 감사하겠습니다."})]}),y&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-[#f9f9f9] z-40 delete_opacity opacity-95"}),(0,a.jsx)("div",{className:"delete_post z-50 delete_sd",children:(0,a.jsxs)("div",{className:"flex flex-col mx-6",children:[(0,a.jsx)("h1",{className:"font-bold text-2xl mb-3 mt-12",children:"회원 탈퇴"}),(0,a.jsx)("p",{className:"mb-2",children:"정말로 탈퇴하시겠습니까?"}),(0,a.jsx)("p",{className:"text-xs text-sky-500 mb-16",children:"이대로 헤어지기는 너무 아쉽습니다..."}),(0,a.jsxs)("div",{className:"flex justify-end mt-12",children:[(0,a.jsx)("button",{onClick:()=>j(e=>!e),type:"button",className:"text-sky-600 hover:text-sky-700 px-6 py-1.5 mr-4 rounded-md",children:"취소"}),(0,a.jsx)("button",{onClick:S,type:"button",className:"text-white bg-sky-600 hover:bg-sky-700 px-6 py-1.5 rounded-md",children:"확인"})]})]})})]})]})]})}},9008:function(e,t,s){e.exports=s(3121)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5824)}),_N_E=e.O()}]);
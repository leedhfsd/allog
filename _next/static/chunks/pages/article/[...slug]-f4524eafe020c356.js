(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[860],{7181:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/[...slug]",function(){return s(1702)}])},1702:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return o}});var l=s(5893),n=s(3299),a=s(1664),i=s.n(a),c=s(9008),r=s.n(c),d=s(1163),m=s(7294);s(1706),s(9499);var o=!0;t.default=function(e){let{data:t,slug:s,userdata:a,commentData:c}=e,[o,x]=(0,m.useState)([]),[u,h]=(0,m.useState)([]),[f,j]=(0,m.useState)(),[v,p]=(0,m.useState)([]),[N,y]=(0,m.useState)(!1),[w,b]=(0,m.useState)([]),[g,k]=(0,m.useState)([]),_=(0,m.useRef)(null),[E,C]=(0,m.useState)(""),{data:S}=(0,n.useSession)(),T=(0,d.useRouter)(),O=async()=>{await T.push("/")},A=e=>{let t=e.target;null!==_.current&&(_.current.style.height="30px",_.current.style.height="".concat(t.scrollHeight,"px")),C(t.value)},D=async()=>{var e,t,l;if(""===E)return;let n=new Date,a=n.getTime()+6e4*n.getTimezoneOffset(),i=new Date(a+324e5),c={author:s[0].substring(1),articleId:s[1],writer:null==S?void 0:null===(e=S.user)||void 0===e?void 0:e.name,email:null==S?void 0:null===(t=S.user)||void 0===t?void 0:t.email,createdAt:"".concat(i.getFullYear(),"년 ").concat(i.getMonth()+1,"월 ").concat(i.getDate(),"일"),profile:null==S?void 0:null===(l=S.user)||void 0===l?void 0:l.image,content:E};await fetch("/api/comment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then(async()=>{_.current&&(C(""),_.current.value="");let e=await fetch("/api/comment?id=".concat(s[1])),t=await e.json();h(t),p([...v,!1])})},z=async(e,t)=>{S&&S.user&&await fetch("/api/comment?id=".concat(e,"&writer=").concat(null==S?void 0:S.user.name),{method:"DELETE"}).then(async()=>{let e=await fetch("/api/comment?id=".concat(s[1])),l=await e.json();h(l),p(e=>e.filter((e,s)=>s!==t))})},L=e=>{p(t=>t.map((s,l)=>l===e&&(C(u[e].content),!t[e])))},P=async()=>{void 0!==f&&(null==S?void 0:S.user)&&(-1===w.indexOf(null==S?void 0:S.user.name)&&b([...w,null==S?void 0:S.user.name]),await fetch("/api/liked?name=".concat(null==S?void 0:S.user.name,"&id=").concat(o[0]._id,"&status=posts"),{method:"POST"}))},F=async()=>{if(void 0!==f&&(null==S?void 0:S.user)){let e=null==S?void 0:S.user.name;-1!==w.indexOf(null==S?void 0:S.user.name)&&b(w.filter(t=>t!==e)),await fetch("/api/liked?name=".concat(null==S?void 0:S.user.name,"&id=").concat(o[0]._id,"&status=posts"),{method:"DELETE"})}},H=async()=>{void 0!==f&&(null==S?void 0:S.user)&&(-1===g.indexOf(null==S?void 0:S.user.name)&&k([...g,null==S?void 0:S.user.name]),await fetch("/api/liked?name=".concat(null==S?void 0:S.user.name,"&user=").concat(f.name,"&status=users"),{method:"POST"}))},I=async()=>{if(void 0!==f&&(null==S?void 0:S.user)){let e=null==S?void 0:S.user.name;-1!==g.indexOf(null==S?void 0:S.user.name)&&k(g.filter(t=>t!==e)),await fetch("/api/liked?name=".concat(null==S?void 0:S.user.name,"&user=").concat(f.name,"&status=users"),{method:"DELETE"})}},M=async e=>{var t,l,n;if(""===E)return;let a=new Date,i=a.getTime()+6e4*a.getTimezoneOffset(),c=new Date(i+324e5),r={writer:null==S?void 0:null===(t=S.user)||void 0===t?void 0:t.name,email:null==S?void 0:null===(l=S.user)||void 0===l?void 0:l.email,createdAt:"".concat(c.getFullYear(),"년 ").concat(c.getMonth()+1,"월 ").concat(c.getDate(),"일"),profile:null==S?void 0:null===(n=S.user)||void 0===n?void 0:n.image,content:E};await fetch("/api/comment?id=".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(async()=>{_.current&&(_.current.value="",C(""));let e=document.getElementById("commentTextarea");e.value="";let t=await fetch("/api/comment?id=".concat(s[1])),l=await t.json();h(l);let n=Array(l.length).fill(!1);p(n)})};(0,m.useEffect)(()=>{if(j(a),x(t),h(c),o.length>0&&b(o[0].liked),Array.isArray(c)){let e=Array(c.length).fill(!1);p(e)}},[t,a,c,o]),(0,m.useEffect)(()=>{(async function(e){let t=await fetch("/api/liked?name=".concat(e)),s=await t.json();Array.isArray(s)&&void 0!==s[0].likesMe&&k([...s[0].likesMe])})(s[0].substring(1)).catch(()=>{throw Error()})},[s]),(0,m.useEffect)(()=>{if(s&&s.length>1&&1===o.length&&o[0].sanitizedHtml){let e=document.getElementById("markdown");e.innerHTML=o[0].sanitizedHtml}},[s,o]);let B=async()=>{await fetch("/api/comment?author=".concat(o[0].writer,"&id=").concat(o[0]._id),{method:"DELETE"}),await fetch("/api/article?writer=".concat(o[0].writer,"&id=").concat(o[0]._id),{method:"DELETE"}).then(()=>O())};return 1===s.length&&o.length>0?(0,l.jsxs)("div",{className:"flex flex-col py-12 items-center w-full",children:[(0,l.jsxs)(r(),{children:[(0,l.jsx)("title",{children:"@".concat(o[0].writer," | Allog")}),(0,l.jsx)("meta",{name:"description",content:"Allog 회원님들의 작성 글, 별명, 한 줄 메시지를 확인할 수 있는 페이지입니다."}),(0,l.jsx)("meta",{name:"keywords",content:"BLOG, 블로그, Allog"})]}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center mb-4",children:[(0,l.jsx)("img",{className:"rounded-full aspect-square mr-16",src:null==f?void 0:f.image,width:128,height:128,alt:"user-profile"}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[f&&""!==f.nickname?(0,l.jsx)("div",{className:"mr-4",children:null==f?void 0:f.nickname}):(0,l.jsx)("div",{className:"mr-4",children:null==f?void 0:f.name}),(0,l.jsx)("span",{children:(null==S?void 0:S.user)&&-1===g.indexOf(S.user.name)?(0,l.jsx)("div",{className:"flex font-bold bg-[#0095F6] rounded-md text-white px-4 py-0.5",children:(0,l.jsx)("button",{type:"button",onClick:H,children:(0,l.jsx)("span",{className:"text-xs",children:"팔로우"})})}):(0,l.jsx)("div",{className:"flex font-bold bg-[#0095F6] rounded-md text-white px-4 py-0.5",children:(0,l.jsx)("button",{type:"button",onClick:I,children:(0,l.jsx)("span",{className:"text-xs",children:"팔로우 취소"})})})})]}),(0,l.jsxs)("div",{className:"text-xs my-4",children:["게시물 ",(0,l.jsx)("span",{className:"font-bold",children:o.length})]}),(0,l.jsx)("div",{className:"mt-1 text-sm",children:null==f?void 0:f.userinfo})]})]}),(0,l.jsx)("hr",{className:"my-4 w-full"}),o.filter(e=>!e.disclosureStatus).map(e=>(0,l.jsxs)("div",{className:"my-8 w-[300px] sm:w-[400px] md:w-[768px]",children:[(0,l.jsxs)(i(),{href:"/article/@".concat(e.writer,"/").concat(e._id,"/").concat(e.slug),children:[e.thumbnailImage?(0,l.jsx)("div",{className:"",children:(0,l.jsx)("img",{alt:"thumbnail",className:"rounded-md inline-block w-full h-[400px] object-center object-cover",src:e.thumbnailImage})}):(0,l.jsx)("div",{}),(0,l.jsx)("h1",{className:"text-xl font-bold my-4 truncate",children:e.title}),(0,l.jsx)("p",{className:"mb-8 line_clamp whitespace-pre-wrap min-h-[16px]",children:e.plainText})]}),(0,l.jsx)("div",{children:e.hashtag.map(e=>(0,l.jsx)("a",{href:"/hashtag/".concat(e),className:"text-sky-500 my-2 cursor-pointer inline-block text-xs",children:e},e))}),(0,l.jsxs)("div",{className:"flex flex-row truncate text-sm text-gray-400",children:[(0,l.jsx)("div",{className:"",children:e.createdAt}),(0,l.jsx)("span",{className:"px-2",children:"\xb7"}),(0,l.jsxs)("div",{children:["❤ ",e.liked.length?e.liked.length:0]})]})]},e._id))]})]}):s.length>=2&&1===o.length?(0,l.jsxs)("div",{className:"w-full",children:[o.map(e=>(0,l.jsxs)("div",{className:"my-16 mx-2 sm:mx-6 md:mx-12 2xl:mx-80 3xl:mx-96",children:[(0,l.jsxs)(r(),{children:[(0,l.jsx)("title",{children:e.title}),(0,l.jsx)("meta",{name:"description",content:"Allog 회원님들의 작성 글을 확인하는 페이지입니다."}),(0,l.jsx)("meta",{name:"keywords",content:"BLOG, 블로그, Allog"})]}),(0,l.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold white break-all whitespace-pre-wrap",children:e.title}),(0,l.jsxs)("div",{className:"flex flex-row justify-between mt-12",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center text-xs sm:text-base",children:[(0,l.jsx)("span",{className:"font-bold ml-2",children:e.writer}),(0,l.jsx)("span",{className:"mx-2",children:"\xb7"}),(0,l.jsx)("span",{className:"text-gray-500",children:e.createdAt})]}),(0,l.jsxs)("div",{className:"flex flex-row",children:[S&&S.user&&S.user.name===s[0].substring(1)&&(0,l.jsxs)("div",{className:"flex items-center text-gray-400 text-xs sm:text-base",children:[(0,l.jsx)("a",{href:"/write?user=".concat(s[0].substring(1),"&id=").concat(s[1]),type:"button",className:"mx-1",children:"수정"}),(0,l.jsx)("button",{type:"button",onClick:()=>y(e=>!e),className:"mr-1",children:"삭제"})]}),(0,l.jsx)("span",{children:(null==S?void 0:S.user)&&-1===w.indexOf(S.user.name)?(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{type:"button",onClick:P,children:"\uD83E\uDD0D"}),(0,l.jsx)("span",{className:"text-xs sm:text-base",children:w.length})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{type:"button",onClick:F,children:"❤"}),(0,l.jsx)("span",{className:"text-xs sm:text-base",children:w.length})]})})]})]}),(0,l.jsx)("div",{children:e.hashtag.map(e=>(0,l.jsx)("a",{href:"/hashtag/".concat(e),className:"text-xs sm:text-base text-sky-500 px-1 mx-2 my-4 cursor-pointer inline-block",children:e},e))}),(0,l.jsx)("div",{className:"whitespace-pre-wrap mt-16 min-h-[328px]",children:o[0].sanitizedHtml?(0,l.jsx)("div",{id:"markdown",className:"markdown-body"}):(0,l.jsx)("div",{children:o[0].content})}),(0,l.jsx)("div",{className:"flex flex-row items-center my-16",children:(0,l.jsxs)(i(),{href:"/article/".concat(s[0]),className:"flex flex-row items-center",children:[(0,l.jsx)("img",{className:"rounded-full mr-4 aspect-square",src:null==f?void 0:f.image,width:128,height:128,alt:"user-profile"}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(null==f?void 0:f.nickname)!==""?(0,l.jsx)("div",{className:"text-base sm:text-xl font-bold",children:null==f?void 0:f.nickname}):(0,l.jsx)("div",{className:"text-base sm:text-xl font-bold",children:null==f?void 0:f.name}),(0,l.jsx)("div",{className:"mt-1 text-xs sm:text-base",children:null==f?void 0:f.userinfo})]})]})})]},e._id)),(0,l.jsxs)("div",{className:"mt-24 sm:mt-48 mx-4 sm:mx-6 md:mx-12 2xl:mx-80 3xl:mx-96 text-gray-600 text-base sm:text-xl",children:[(0,l.jsx)("span",{className:"font-bold text-black",children:u.length?u.length:0}),"개의 댓글"]}),S&&(0,l.jsxs)("div",{className:"mx-4 sm:mx-6 md:mx-12 my-12 2xl:mx-80 3xl:mx-96",children:[(0,l.jsx)("textarea",{id:"commentTextarea",rows:1,className:"focus:outline-none resize-none w-full truncate",placeholder:"댓글을 남겨주세요.",ref:_,onChange:A}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("button",{type:"button",className:"text-white px-4 py-1 mt-8 bg-sky-500 rounded",onClick:D,children:"댓글 작성"})})]}),(0,l.jsx)("div",{className:"mx-4 sm:mx-6 md:mx-12 2xl:mx-80 3xl:mx-96 mb-32",children:u.length>0&&u.map((e,t)=>{var s;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)("div",{className:"flex my-8",children:[(0,l.jsx)(i(),{href:"/article/@".concat(e.writer),children:(0,l.jsx)("img",{src:e.profile,alt:"profile",height:48,width:48,className:"rounded-full"})}),(0,l.jsxs)("div",{className:"flex flex-col mx-4",children:[(0,l.jsx)(i(),{href:"/article/@".concat(e.writer),children:(0,l.jsx)("div",{className:"font-bold",children:e.writer})}),(0,l.jsx)("div",{className:"text-gray-500 text-sm",children:e.createdAt})]})]}),e.writer===(null==S?void 0:null===(s=S.user)||void 0===s?void 0:s.name)&&(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("button",{type:"button",className:"text-gray-500 text-sm mx-1",onClick:()=>L(t),children:"수정"}),(0,l.jsx)("button",{type:"button",className:"text-gray-500 text-sm",onClick:()=>z(e._id.toString(),t),children:"삭제"})]})]}),v[t]?(0,l.jsxs)("div",{children:[(0,l.jsx)("textarea",{rows:1,className:"focus:outline-none resize-none w-full truncate",placeholder:"댓글을 남겨주세요.",ref:_,onChange:A,value:E}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{className:"text-sky-500 px-4 py-1",type:"button",onClick:()=>L(t),children:"취소"}),(0,l.jsx)("button",{type:"button",className:"text-white px-4 py-1 mt-8 bg-sky-500 rounded",onClick:()=>M(e._id.toString()),children:"댓글 수정"})]})})]}):(0,l.jsx)("div",{id:e._id.toString(),className:"whitespace-pre-wrap mb-12",children:e.content})]},e._id.toString())})}),N&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"bg-[#f9f9f9] z-40 delete_opacity opacity-95"}),(0,l.jsx)("div",{className:"w-[300px] h-[200px] sm:w-[450px] sm:h-[300px] delete_post z-50 delete_sd",children:(0,l.jsxs)("div",{className:"flex flex-col mx-6",children:[(0,l.jsx)("h1",{className:"font-bold text-2xl mb-3 mt-2 sm:mt-12",children:"포스트 삭제"}),(0,l.jsx)("p",{className:"mb-16",children:"정말로 삭제하시겠습니까?"}),(0,l.jsxs)("div",{className:"flex justify-end sm:mt-12",children:[(0,l.jsx)("button",{onClick:()=>y(e=>!e),type:"button",className:"text-sky-600 hover:text-sky-700 px-6 py-1.5 mr-4 rounded-md",children:"취소"}),(0,l.jsx)("button",{onClick:B,type:"button",className:"text-white bg-sky-600 hover:bg-sky-700 px-6 py-1.5 rounded-md",children:"확인"})]})]})})]})]}):(0,l.jsxs)("div",{className:"flex flex-col py-12 mx-4",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center mb-4",children:[(0,l.jsx)("img",{className:"rounded-full aspect-square mr-16",src:null==f?void 0:f.image,width:128,height:128,alt:"user-profile"}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[f&&""!==f.nickname?(0,l.jsx)("div",{className:"mr-4",children:null==f?void 0:f.nickname}):(0,l.jsx)("div",{className:"mr-4",children:null==f?void 0:f.name}),(0,l.jsx)("span",{children:(null==S?void 0:S.user)&&-1===g.indexOf(S.user.name)?(0,l.jsx)("div",{className:"flex font-bold bg-[#0095F6] rounded-md text-white px-4 py-0.5",children:(0,l.jsx)("button",{type:"button",onClick:H,children:(0,l.jsx)("span",{className:"text-xs",children:"팔로우"})})}):(0,l.jsx)("div",{className:"flex font-bold bg-[#0095F6] rounded-md text-white px-4 py-0.5",children:(0,l.jsx)("button",{type:"button",onClick:I,children:(0,l.jsx)("span",{className:"text-xs",children:"팔로우 취소"})})})})]}),(0,l.jsxs)("div",{className:"text-xs my-4",children:["게시물 ",(0,l.jsx)("span",{className:"font-bold",children:"0"})]}),(0,l.jsx)("div",{className:"mt-1 text-sm",children:null==f?void 0:f.userinfo})]})]}),(0,l.jsx)("hr",{className:"my-4 w-full"})]})}},9499:function(){},1706:function(){},9008:function(e,t,s){e.exports=s(3121)}},function(e){e.O(0,[218,774,888,179],function(){return e(e.s=7181)}),_N_E=e.O()}]);